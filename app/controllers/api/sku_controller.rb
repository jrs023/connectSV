class Api::SkuController < ApplicationController
  require 'json'
  def index   
    #SKUS
    #skus = "9781910307106,9781910307229,9781908762481,9781908762207,9781908317810,9780958184335,9781784980337,9781784980764,9781909559004,9781910307984,9781784980214,9781906334987,9781907377655,9781907377396,9781907377662,9781907377419,9781907377242,9781784981655,9781784981914,cecard,9781784980795,9781784981464,ceguide,9781784980771,9781784980955,9781784981365,9781784980924,9781784981624,9781784981372,9781784980818,9781784980788,9780858923942,9781905564804,9781905564750,9781908317148,9781908762221,9781909559066,9781909919884,9781910307854,9781908317186,9781906334253,9781909559998,9781907377761,9781907377785,9781908762733,9781905564262,9781908317919,9781907377754,9781908762764,9781907377587,9781907377914,9781907377921,9781907377938,9781908317803,9781907377631,9781908317889,9781908317872,9789622449190,9781906334604,9789622449213,9781906334598,9781906334611,9789622449237,9781906334581,9781907377174,9781908762658,9781908762665,9781784980535,9781784980542,9781784980559,9781784980566,9781784980573,9781907377334,9781909919808,9781909919174,9781909919181,9781909919815,9781909919198,9781905564552,9781907377082,9781907377723,9781907377730,9781873166918,9781784980757,9781906334628,9781908317469,9781908317698,9781908317445,9781906334895,9781906334857,9781906334840,9781784981075,9781784981051,9781784981082,9781784981068,9781906334031,9781906334048,9781906334055,9781906334062,9781906334079,9781906334086,9781906334093,9781906334109,9781906334116,9781906334123,9781906334130,9781906334147,9781906334154,9781906334161,9781906334178,9781906334185,9781906334192,9781906334208,9781906334215,9781906334222,9781910307762,9781910307748,9781909919693,9781909919716,9781909919709,9781910307779,9781910307526,9781910307533,9781909919310,9781909919099,9781909919105,9781784980528,9781909919112,9781784980436,9781784981242,9781784980962,9781784981235,9781784981228,9781908317476,9781910307120,9781784980863,9781909559417,9781905564941,f1607ce_us,9781909919433,9781905564453,9781908317858,9781909919822,9781908317865,9781906334994,9781784980375,9781909919570,9781910307267,9781910307656,9781784980245,9781908762573,9781910307809,9781908762900,9781784981099,9781908762917,9781910307298,9781909919617,9781908317681,9781908317964,9781904889953,9781907377976,9781907377853,9781784980177,9781909919594,9781904889533,9781906334758,9781905564569,9781905564415,9781909919303,9781908317261,9781907377532,9781905564293,9781908317070,9781908317766,9781908317834,9781908317582,9781906334246,9781905564668,9781909559202,9781908762993,9781910307328,9781904889984,9781906334437,9781909559240,9781907377099,9781910307694,9781908317926,9781784980269,9781904889274,9781908762566,9781907377112,9781909919457,9781906334420,9781905564255,9781910307816,9781907377129,9781907377433,9781908762887,9781784980160,9781905564460,9781904889281,9781904889519,9781908317483,9781909559165,9781908317933,9781910307595,9781904889960,9781905564682,9781908762924,9781910307311,9781905564910,9781784980092,gscliner,gsclivbox,gsclivbull,gsclivcard,9781909919280,9781909919273,9781909919266,gscmercybox,gscmercycard,gscoutbox,gscoutbull,gscoutcard,9781909919518,9781909919501,9781909919297,gscquickguide,gscworkbox,gscworkbull,gscworkcard,9781909919259,9781909919242,9781909919235,gscworshipbox,gscworshipbull,gscworshipcard,9781909919228,9781909919211,9781909919204,9781784981501,9781905564217,9781909919631,9781904889526,9781908762894,9781904889267,9781784981617,9781908762429,9781784981730,9781784981723,9781784981747,9781909559912,9781908762382,9781909559042,9781908762856,9781908762351,9781909919655,9781909919648,9781909919686,9781904889540,9781907377228,9781905564736,9781905564743,9781905564712,9781905564729,9781908762078,9781909919860,9781784981204,9781909919396,9781910307373,9781910307359,9781909919846,9781910307823,9781909919372,9781784980849,9781784980825,9781784980832,9781910307410,9781910307403,9781910307687,9781910307670,9781909919778,9781909919761,9781784981037,9781909919907,9781784980511,9781784981044,9781906334673,9781907377440,9781907377747,9781908762375,9781909559813,9781909559110,9781907377372,9781907377303,9781873166994,9781906334956,9781907377983,9781908317605,9781909559059,9781907377259,9781907377907,9781909559837,9781908762580,9781784980702,9781905564361,9781905564231,9781784981662,9781909919471,9781905564224,9781905564897,9781908317599,9781784980061,9781784980306,9781910307397,9781908317322,9781906334574,9781907377297,9781906334635,9781906334925,9781784980078,9781909559196,9781909559134,9781909559141,9781909919013,9781908762306,9781908762337,9781909559158,9781909559653,9781909559783,9781910307236,9781909919051,9781908762320,9781908762313,9780000010469,9781908762627,9781906334680,9780952489429,9780980322705,9781784980153,9781908762696,9781908762702,9781784980122,9781910307960,9781910307113,9781784980139,9781910307434,9781908317735,9781906334345,9781784980276,9781905564781,9781905564798,9781910307083,9781904889014,9781908762771,9781909559929,9781908762269,9781908317742,9781905564347,9781906334284,9781910307991,9781784981532,9781784981952,9781908317957,9781909559172,9781910307038,9781909559356,9781873166925,9781904889137,9781904889151,9781904889175,9781873166949,9781873166970,9781873166772,9781873166352,9781873166536,9781873166796,9781904889090,9781904889113,9781909919556,9781907377358,9781907377365,9781907377716,9781909919150,9781910307632,9781873166574,9781905564606,9781873166581,9781905564620,9781873166598,9781905564644,9781904889601,9781873166932,9781904889120,9781904889144,9781904889168,9781873166956,9781873166253,9781873166109,9781873166369,9781873166512,9781873166697,9781904889083,9781904889106,9781873166888,9781873166895,9781873166901"
      
    skus = params[:skus]
    title = []
    onhand= []
    pending = []
    available = []
    incoming = []
    reorder = []
    previous_p = "";
    
	if skus.split(',').size() > 110
		total = skus.split(',').size()
		start_point = 0;
		end_point = 110;
		t = skus.split(',')
		while(start_point != end_point)
			temp = t[start_point..end_point]
			temp_skus = temp.join(",")
			
			gp_response = HTTParty.post("https://app.skuvault.com/api/products/getProducts", :query =>{:ProductSKUs => temp_skus,:UserToken => "rU+wISuzqhzmJI2y5A0I3QX6bdmBB4lXpqeQtDk1ukM=", :TenantToken => "lxe4jjI1279ozpNWB9gecweAFl12kU+gngKjmL1ZNCg=", :format => "json"})
			gp_response['Products'].each do |p|
				if(previous_p != p['Description'])
					title.append(p['Description'])  
					onhand.append(p['QuantityOnHand'])    		
					pending.append(p['QuantityPending'])		
					available.append(p['QuantityAvailable'])
					incoming.append(p['QuantityIncoming'])
					reorder.append(p['ReorderPoint'])
				end
				previous_p = p['Description']
			end
			start_point = end_point
			if(end_point + 110 > total)
				end_point = start_point + (total - end_point)+1
			else
				end_point = end_point+110
			end
			
			puts start_point.to_s + " " + end_point.to_s + " " + gp_response['Products'].size.to_s
		end
	else
		 gp_response = HTTParty.post("https://app.skuvault.com/api/products/getProducts", :query =>{:ProductSKUs => skus,:UserToken => "rU+wISuzqhzmJI2y5A0I3QX6bdmBB4lXpqeQtDk1ukM=", :TenantToken => "lxe4jjI1279ozpNWB9gecweAFl12kU+gngKjmL1ZNCg=", :format => "json"})
		#render json: JSON.pretty_generate(gp_response)
		gp_response['Products'].each do |p|
			if(previous_p != p['Description'])
				title.append(p['Description'])  
				onhand.append(p['QuantityOnHand'])    		
				pending.append(p['QuantityPending'])		
				available.append(p['QuantityAvailable'])
				incoming.append(p['QuantityIncoming'])
				reorder.append(p['ReorderPoint'])
			end
			previous_p = p['Description']
		end
	end		 
	    
	    
	my_object = { :title => title, :skus => skus.split(","), :onhand => onhand, :pending => pending, :available => available, :incoming => incoming, :reorder => reorder}
	render json: my_object.to_json, :callback => params[:callback]
  end
end
